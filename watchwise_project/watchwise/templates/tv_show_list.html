{% extends 'base.html' %}
{% load static %}
{% block title %}TV Shows{% endblock %}
{% block content %}
<div class="container my-5">
  {% if messages %}
  <div class="alert alert-success">
    {% for message in messages %}
    <strong>{{ message }}</strong>
    {% endfor %}
  </div>
  {% endif %}
  <h1 class="mb-4">List of TV Shows</h1>
  <div class="d-flex justify-content-between align-items-center">
    <div>
      <form method="get">
        <label for="per_page">Records per Page:</label>
        <select name="per_page" id="per_page" onchange="this.form.submit()">
          <option value="10" {% if per_page == "10" %}selected{% endif %}>10</option>
          <option value="20" {% if per_page == "20" %}selected{% endif %}>20</option>
          <option value="30" {% if per_page == "30" %}selected{% endif %}>30</option>
          <option value="50" {% if per_page == "50" %}selected{% endif %}>50</option>
          <option value="100" {% if per_page == "100" %}selected{% endif %}>100</option>
        </select>
      </form>
    </div>
    <div>
      <form action="{% url 'search_title_tv' %}" method="get" class="d-inline-block">
        <input type="text" class="form-control" placeholder="Search by title" name="title" onkeypress="return event.keyCode != 13;" />
        <input type="hidden" name="page" value="{{ tv_shows.number }}">
        <input type="hidden" name="per_page" value="{{ per_page }}">
        <button type="submit" class="btn btn-primary btn-sm">Search TV Show</button>
      </form>
      <form action="{% url 'search_status_tv' %}" method="get" class="d-inline-block">
        <select class="form-control" name="status">
          <option value="">--Select Status--</option>
          <option value="watched">Watched</option>
          <option value="wishlist">Wishlist</option>
          <option value="not_interested">Not Interested</option>
        </select>
        <input type="hidden" name="page" value="{{ tv_shows.number }}">
        <input type="hidden" name="per_page" value="{{ per_page }}">
        <button type="submit" class="btn btn-primary btn-sm">Search by Status</button>
      </form>
      <form action="{% url 'search_rating_tv' %}" method="get" class="d-inline-block">
        <input type="text" class="form-control" placeholder="Search by rating" name="rating" onkeypress="return event.keyCode != 13;" />
        <input type="hidden" name="page" value="{{ tv_shows.number }}">
        <input type="hidden" name="per_page" value="{{ per_page }}">
        <button type="submit" class="btn btn-secondary btn-sm">Search by Rating</button>
      </form>
      <a href="{% url 'tv_show_list' %}" class="btn btn-warning btn-sm">Reset</a>
    </div>  
  </div>
  {% if tv_shows %}
  <div class="container">
    <table class="table">
      <thead class="thead-dark">
        <tr>
          <th scope="col">#</th>
          <th scope="col">
            Title<br>
            <a href="{% url 'sort_tv_shows_by_title' %}?sort_title=title">⬆️</a>
            <a href="{% url 'sort_tv_shows_by_title' %}?sort_title=-title">⬇️</a>
          </th>
          <th scope="col">
            Year
            <a href="{% url 'sort_tv_shows_by_year' %}?sort_year=first_air_date">⬆️</a>
            <a href="{% url 'sort_tv_shows_by_year' %}?sort_year=-first_air_date">⬇️</a>
          </th>
          
          <th scope="col">Description</th><br>
          <th scope="col">Original Language</th><br>
          <th scope="col">Status</th><br>
          <th scope="col">
            Rating<br>
            <a href="{% url 'sort_tv_shows_by_rating' %}?sort_rating=rating">⬆️</a>
            <a href="{% url 'sort_tv_shows_by_rating' %}?sort_rating=-rating">⬇️</a>
          </th>
          <th scope="col">Comment</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
    <tbody>
        {% for tv_show in tv_shows.object_list %}
        <tr>
          <th scope="row">{{ forloop.counter }}</th>
          <td>{{ tv_show.title }}</td>
          <td>{{ tv_show.first_air_date }}</td>
          <td>{{ tv_show.overview }}</td>
          <td>{{ tv_show.original_language }}</td>
          <td>{{ tv_show.get_status_display }}</td>
          <td>{{ tv_show.rating }}</td>
          <td>{{ tv_show.comment }}</td>
          <td>
            <a href="{% url 'delete_media' 'tv' tv_show.TV_id %}">Delete</a>
            <a href="{% url 'update_media' 'tv' tv_show.TV_id %}">Update</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="pagination">
    <span class="step-links">
      {% if tv_shows.has_previous %}
        <a href="?page=1&per_page={{ per_page }}">First</a>
        <a href="?page={{ tv_shows.previous_page_number }}&per_page={{ per_page }}">Previous</a>
      {% endif %}
      <span class="current">
        Page {{ tv_shows.number }} of {{ tv_shows.paginator.num_pages }}.
      </span>
      {% if tv_shows.has_next %}
        <a href="?page={{ tv_shows.next_page_number }}&per_page={{ per_page }}">Next</a>
        <a href="?page={{ tv_shows.paginator.num_pages }}&per_page={{ per_page }}">Last</a>
      {% endif %}
    </span>
  </div>
  {% else %}
  <p>No records found.</p>
  {% endif %}
</div>
{% endblock %}
th a {
  display: inline;
}
